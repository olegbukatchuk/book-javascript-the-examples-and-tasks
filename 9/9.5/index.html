<!DOCTYPE HTML>
<html>
    <head>
        <title>Листинг 9.5</title>
        <script type="text/javascript">
            var rows = 3, cols = 6;
            var file = "../images/pets.jpg";
            var R = 2;
            var Cnv, outCnv;
            var Ctx, outCtx;
            var mytab;
            var myimg;
            window.onload = function() {
                myimg = new Image();
                myimg.src = file;
                mytab = document.getElementById("mytable");
                outCnv = document.getElementById("output");
                outCtx = outCnv.getContext("2d");
                Cnv = new Array(rows);
                Ctx = new Array(rows);
                for (var i = 0; i < rows; i++) {
                    mytab.insertRow(i);
                    Cnv[i] = new Array(cols);
                    Ctx[i] = new Array(cols);
                    for (var j = 0; j < cols; j++) {
                        mytab.rows[i].insertCell(j);
                        Cnv[i][j] = document.createElement("canvas");
                        Ctx[i][j] = Cnv[i][j].getContext("2d");
                        mytab.rows[i].cells[j].appendChild(Cnv[i][j]);
                        mytab.rows[i].cells[j].onmouseover = function() {
                            var m, n;
                            m = this.parentElement.rowIndex;
                            n = this.cellIndex;
                            Cnv[m][n].style.borderColor = "#505050";
                            outCnv.style.borderColor = "#505050";
                            outCtx.drawImage(Cnv[m][n], 0, 0, Cnv[m][n].width, Cnv[m][n].height, 0, 0, outCnv.width, outCnv.height);
                        };
                        mytab.rows[i].cells[j].onmouseout = function() {
                            var cnv;
                            cnv = this.getElementsByTagName("canvas")[0];
                            cnv.style.borderColor = "silver";
                            outCnv.style.borderColor = "silver";
                            outCtx.clearRect(0, 0, outCnv.width, outCnv.height);
                        }
                    }
                }
                myimg.onload = function() {
                    var width, height;
                    width = Math.floor(this.width / cols);
                    height = Math.floor(this.height / rows);
                    outCnv.height = Math.round(R * height);
                    outCnv.width = Math.round(R * width);
                    for (var i = 0; i < Cnv.length; i++) {
                        for (var j = 0; j < Cnv[i].length; j++) {
                            Cnv[i][j].width = width;
                            Cnv[i][j].height = height;
                            Cnv[i][j].style.border = "solid";
                            Cnv[i][j].style.borderWidth = "3px";
                            Cnv[i][j].style.borderColor = "silver";
                            Ctx[i][j].drawImage(this, j * width, i * height, width, height, 0, 0, width, height);
                        }
                    }
                }
            }
        </script>
        <style type="text/css">
            #mytable {
                padding: 2px;
                border-style: solid;
                border-width: 3px;
                border-color: silver;
                border-spacing: 0px;
            }
            #mytable td {
                padding: 0px 2px;
            }
            #output {
                border-style: solid;
                border-color: silver;
                border-width: 3px;
                padding: 2px;
            }
        </style>
    </head>
    <body>
        <h3>Листинг 9.5</h3><hr>
        <table>
            <tr>
                <td style="vertical-align:top;">
                    <table id="mytable"></table>
                </td>
                <td style="vertical-align:top;">
                    <canvas id="output"><canvas>
                </td>
            </tr>
        </table>
    </body>
</html>